wantType:
  metadata:
    name: reminder
    title: Reminder Notification
    description: |
      Sends a reminder notification at a scheduled time with optional user reaction.

      Supports both one-time and recurring reminders through the when specification.
      The reminder goes through three phases: waiting (until reaching_time), reaching
      (sending notification and optionally waiting for reaction), and completed.

      The 'ahead' parameter allows sending the reminder N time units before the
      scheduled event time. For example, with event_time at 14:00 and ahead: "10 minutes",
      the reminder enters the reaching phase at 13:50.
    version: '1.0'
    category: system
    pattern: independent

  parameters:
  - name: message
    description: Reminder message to display
    type: string
    required: true
    example: "Team meeting in 10 minutes"

  - name: ahead
    description: How much time before the event to trigger the reminder
    type: string
    default: "5 minutes"
    required: false
    validation:
      pattern: '\d+ (seconds|minutes|hours|days)'
    example: "10 minutes"

  - name: event_time
    description: |
      RFC3339 formatted time for the scheduled event.
      Either event_time or when spec (recurring) must be provided.
    type: string
    required: false
    example: "2025-12-28T14:00:00Z"

  - name: require_reaction
    description: |
      If true, reminder requires user approval/rejection via API.
      If false, reminder auto-completes after reaching the event time.
    type: bool
    default: false
    required: false
    example: true

  - name: reaction_type
    description: Type of reaction channel (internal API by default)
    type: string
    default: "internal"
    required: false
    validation:
      enum:
      - internal
      - slack
      - webhook
    example: "internal"

  state:
  - name: reminder_phase
    description: Current phase of the reminder (waiting, reaching, completed, failed)
    type: string
    persistent: true
    initialValue: waiting
    example: reaching

  - name: message
    description: The reminder message
    type: string
    persistent: true
    initialValue: ''
    example: "Team meeting in 10 minutes"

  - name: ahead
    description: Duration string for advance notification (e.g., "5 minutes")
    type: string
    persistent: true
    initialValue: "5 minutes"
    example: "10 minutes"

  - name: event_time
    description: RFC3339 timestamp of the scheduled event
    type: string
    persistent: true
    initialValue: ''
    example: "2025-12-28T14:00:00Z"

  - name: reaching_time
    description: RFC3339 timestamp when reminder enters reaching phase
    type: string
    persistent: true
    initialValue: ''
    example: "2025-12-28T13:50:00Z"

  - name: reaction_id
    description: Unique identifier for tracking user reactions
    type: string
    persistent: true
    initialValue: ''
    example: 'reminder-meeting-1735376400123'

  - name: require_reaction
    description: Whether user reaction is required
    type: bool
    persistent: true
    initialValue: false
    example: true

  - name: reaction_type
    description: Type of reaction channel
    type: string
    persistent: true
    initialValue: 'internal'
    example: 'slack'

  - name: user_reaction
    description: User's reaction (written by MonitorAgent)
    type: object
    persistent: true
    initialValue: {}
    example: '{"approved": true, "comment": "Approved"}'

  - name: reaction_result
    description: Result of user reaction (approved or rejected)
    type: string
    persistent: true
    initialValue: ''
    example: 'approved'

  - name: timeout
    description: Whether the reminder timed out waiting for reaction
    type: bool
    persistent: true
    initialValue: false
    example: true

  - name: auto_completed
    description: Whether the reminder auto-completed without requiring reaction
    type: bool
    persistent: true
    initialValue: false
    example: true

  - name: error_message
    description: Error message if reminder failed
    type: string
    persistent: true
    initialValue: ''
    example: 'Invalid event_time format'

  constraints:
  - description: Message parameter is required
    validation: message must not be empty

  - description: Either event_time or when spec must be provided
    validation: event_time or when specification required

  - description: Ahead parameter must be valid duration
    validation: ahead must match pattern like "5 minutes", "10 seconds", etc

  - description: require_reaction must be boolean
    validation: require_reaction must be true or false

  examples:
  - name: Simple Auto-Complete Reminder
    description: One-time reminder that auto-completes without requiring user reaction
    expectedBehavior: |
      AHEAD PARAMETER CALCULATION:
      • event_time: 2025-12-28T14:00:00Z
      • ahead: "10 minutes"
      • reaching_time = event_time - ahead = 2025-12-28T13:50:00Z

      TIMELINE:
      1. 13:50:00 - Reminder enters "reaching" phase (notification sent)
      2. 13:50:00-14:00:00 - Notification active for 10 minutes
      3. 14:00:00 - reminder_phase transitions to "completed" (auto-complete)

      BEHAVIOR:
      • No user interaction required
      • Reminder automatically completes at event_time
      • Useful for informational alerts, countdown timers
    want:
      metadata:
        name: meeting_reminder
        type: reminder
      spec:
        params:
          message: "Team meeting starting soon"
          ahead: "10 minutes"
          event_time: "2025-12-28T14:00:00Z"
          require_reaction: false

  - name: Reminder Requiring Approval
    description: Reminder that requires user approval via API before completing
    expectedBehavior: |
      AHEAD PARAMETER CALCULATION:
      • event_time: 2025-12-28T15:00:00Z
      • ahead: "5 minutes"
      • reaching_time = event_time - ahead = 2025-12-28T14:55:00Z

      TIMELINE:
      1. 14:55:00 - Reminder enters "reaching" phase
      2. 14:55:00-15:05:00 - Awaiting user reaction (5 min timeout + 5 min buffer)
      3. User submits: POST /api/v1/reactions/{reaction_id}
         {"approved": true, "comment": "Approved"}
      4. MonitorAgent detects reaction, updates state
      5. Process() transitions to "completed"

      REACTION API EXAMPLE:
      curl -X POST /api/v1/reactions/reminder-deployment_approval-1735286100123 \
        -H "Content-Type: application/json" \
        -d '{"approved": true, "comment": "Approved by DevOps"}'

      BEHAVIOR:
      • Requires external approval via API call
      • Timeout after 5 minutes with no response
      • Can be rejected or approved via single API call
      • Useful for critical decisions, deployments
    want:
      metadata:
        name: deployment_approval
        type: reminder
      spec:
        params:
          message: "Please approve production deployment"
          ahead: "5 minutes"
          event_time: "2025-12-28T15:00:00Z"
          require_reaction: true

  - name: Long Advance Warning
    description: Reminder with extended ahead time for important events
    expectedBehavior: |
      AHEAD PARAMETER CALCULATION:
      • event_time: 2025-12-29T22:00:00Z
      • ahead: "1 hours"
      • reaching_time = event_time - ahead = 2025-12-29T21:00:00Z

      TIMELINE:
      1. 21:00:00 - Reminder enters "reaching" phase (1 hour before event)
      2. 21:00:00-22:00:00 - Extended notification window (60 minutes)
      3. 22:00:00 - reminder_phase transitions to "completed"

      BEHAVIOR:
      • Extended preparation time (1 hour)
      • Useful for system maintenance, major events
      • Gives users ample time to prepare or react
      • Auto-completes if no reaction required
    want:
      metadata:
        name: system_maintenance
        type: reminder
      spec:
        params:
          message: "System maintenance window in 1 hour - save your work"
          ahead: "1 hours"
          event_time: "2025-12-29T22:00:00Z"
          require_reaction: false

  - name: Recurring Daily Reminder
    description: Reminder that recurs daily at a specific time
    expectedBehavior: |
      WHEN SPECIFICATION:
      • at: "9am" - Execute at 9:00 AM daily
      • every: "day" - Repeat pattern

      AHEAD PARAMETER CALCULATION (each day):
      • event_time: 9:00 AM
      • ahead: "5 minutes"
      • reaching_time = 08:55 AM (each day)

      DAILY TIMELINE:
      1. 08:55:00 - Reminder enters "reaching" phase
      2. 08:55:00-09:00:00 - Notification active for 5 minutes
      3. 09:00:00 - reminder_phase transitions to "completed"
      4. SchedulerAgent restarts for next day's 09:00 AM
      5. Cycle repeats indefinitely

      BEHAVIOR:
      • Automatically recurring each day
      • Same notification time each day
      • Useful for daily standups, status checks
      • No manual intervention needed
    want:
      metadata:
        name: daily_standup
        type: reminder
      spec:
        params:
          message: "Daily standup meeting in 5 minutes"
          ahead: "5 minutes"
          require_reaction: false
        when:
          - at: "9am"
            every: "day"

  - name: Recurring Weekly Reminder with Reaction
    description: Weekly reminder that requires user acknowledgment
    expectedBehavior: |
      WHEN SPECIFICATION:
      • at: "10am" - Execute at 10:00 AM
      • every: "week" - Repeat weekly (default Monday)

      AHEAD PARAMETER CALCULATION (weekly):
      • event_time: 10:00 AM every Monday
      • ahead: "10 minutes"
      • reaching_time = 09:50 AM (Mondays)

      WEEKLY TIMELINE:
      Monday:
      1. 09:50:00 - Reminder enters "reaching" phase
      2. 09:50:00-10:05:00 - Awaiting user reaction
      3. User submits via: POST /api/v1/reactions/{reaction_id}
      4. If approved: reminder_phase = "completed"
      5. If rejected or timeout: reminder_phase = "failed"
      6. Next Monday, new reminder instance created

      REACTION TIMEOUT:
      • Default timeout: 5 minutes from reaching phase
      • If no reaction within timeout: automatic failure

      BEHAVIOR:
      • Weekly recurring pattern
      • Requires explicit user approval
      • Useful for weekly reviews, approvals
      • Previous week's outcome doesn't affect next week
    want:
      metadata:
        name: weekly_report_approval
        type: reminder
      spec:
        params:
          message: "Please review and approve the weekly report"
          ahead: "10 minutes"
          require_reaction: true
          reaction_type: "internal"
        when:
          - at: "10am"
            every: "week"

  - name: Emergency Alert (Minimal Ahead)
    description: Time-critical alert with minimal advance notice
    expectedBehavior: |
      AHEAD PARAMETER CALCULATION:
      • event_time: 2025-12-28T21:35:30Z
      • ahead: "10 seconds"
      • reaching_time = 2025-12-28T21:35:20Z

      TIMELINE:
      1. 21:35:20 - Reminder enters "reaching" phase (emergency alert sent)
      2. 21:35:20-21:35:25 - Quick reaction window (only 5-10 seconds)
      3. User must react immediately via API
      4. 21:35:30 - Hard deadline reached
      5. If no reaction: reminder_phase = "failed"

      BEHAVIOR:
      • Minimal lead time (10 seconds)
      • Critical for emergency situations
      • Requires require_reaction: true for immediate action
      • Short timeout window - quick decision needed
      • Useful for alerts, emergency stop commands
    want:
      metadata:
        name: critical_alert
        type: reminder
      spec:
        params:
          message: "CRITICAL: Database connection pool exhausted"
          ahead: "10 seconds"
          event_time: "2025-12-28T21:35:30Z"
          require_reaction: true
          reaction_type: "internal"

  relatedTypes:
  - execution_result
  - coordinator

  seeAlso:
  - Reminder scheduling documentation
  - User reaction API specification
  - Recurring schedule patterns

  require:
    type: none
