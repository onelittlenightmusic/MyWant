wantType:
  metadata:
    name: sink
    title: Data Sink / Terminal Processor
    description: Terminal node that consumes items from pipeline without producing
      output; aggregates and reports statistics
    version: '1.0'
    category: queue
    pattern: sink
  parameters:
  - name: operation
    description: Operation to perform on received items
    type: string
    default: count
    required: false
    validation:
      enum:
      - count
      - sum
      - average
      - min
      - max
      - collect
      - discard
    example: count
  - name: report_interval
    description: Interval in seconds between progress reports
    type: float64
    default: 1.0
    required: false
    validation:
      min: 0.1
      max: 3600
    example: 1.0
  - name: enable_logging
    description: Whether to log each received item
    type: bool
    default: false
    required: false
  - name: log_sample_rate
    description: If logging, sample this fraction of items (0.0 to 1.0)
    type: float64
    default: 0.1
    required: false
    validation:
      min: 0.0
      max: 1.0
  - name: max_items
    description: Maximum items to process before stopping (-1 = unlimited)
    type: int
    default: -1
    required: false
    validation:
      min: -1
  state:
  - name: total_count
    description: Total number of items received
    type: int
    persistent: true
    example: 1000
  - name: sum
    description: Sum of all numeric items (if operation is sum)
    type: float64
    persistent: true
    example: 50500
  - name: average
    description: Average value of numeric items (if operation is average)
    type: float64
    persistent: true
    example: 50.5
  - name: min_value
    description: Minimum value seen (if operation is min)
    type: float64
    persistent: true
    example: 1
  - name: max_value
    description: Maximum value seen (if operation is max)
    type: float64
    persistent: true
    example: 100
  - name: collected_items
    description: Array of collected items (if operation is collect)
    type: '[]interface{}'
    persistent: true
    example: '[1, 2, 3, 4, 5, ...]'
  - name: start_time
    description: ISO8601 timestamp when sink started receiving items
    type: string
    persistent: true
  - name: end_time
    description: ISO8601 timestamp when sink finished processing
    type: string
    persistent: true
  - name: processing_time_seconds
    description: Total time spent processing all items
    type: float64
    persistent: true
    example: 10.5
  - name: throughput_items_per_second
    description: Average throughput (items / processing time)
    type: float64
    persistent: true
    example: 95.2
  - name: last_item
    description: The most recently received item
    type: interface{}
    persistent: false
  - name: items_discarded
    description: Count of items rejected when max_items reached
    type: int
    persistent: true
    example: 0
  connectivity:
    inputs:
    - name: input
      type: want
      description: Items to consume and process
      required: true
    outputs: []
  agents: []
  constraints:
  - description: Report interval must be positive
    validation: report_interval > 0
  - description: Sample rate must be between 0 and 1
    validation: log_sample_rate >= 0.0 and log_sample_rate <= 1.0
  - description: Max items must be positive or -1 (unlimited)
    validation: max_items > 0 or max_items == -1
  - description: Operation must be valid aggregation function
    validation: operation in [count, sum, average, min, max, collect, discard]
  examples:
  - name: Count items from queue
    description: Terminal sink that counts all items passing through
    params:
      operation: count
      report_interval: 1.0
      enable_logging: false
    expectedBehavior: '1. Receives items from connected queue want

      2. Increments total_count for each item

      3. Reports statistics every 1 second

      4. Output shows total items processed and throughput

      '
    connectedTo:
    - queue
  - name: Sum and average calculation
    description: Sink that calculates statistics on numeric items
    params:
      operation: average
      report_interval: 2.0
      enable_logging: false
    expectedBehavior: '1. Receives numeric values

      2. Tracks sum and count

      3. Calculates running average

      4. Reports min/max values seen

      '
    connectedTo:
    - numbers
    - queue
  - name: Detailed logging sink
    description: Sink with sampling-based logging for debugging
    params:
      operation: collect
      report_interval: 0.5
      enable_logging: true
      log_sample_rate: 0.05
      max_items: 1000
    expectedBehavior: '1. Logs 5% of items to console/file

      2. Collects all items up to limit (1000)

      3. Reports every 0.5 seconds

      4. Stops after max_items reached

      '
    connectedTo:
    - queue
  - name: Throughput monitor
    description: Sink focused on measuring throughput characteristics
    params:
      operation: count
      report_interval: 0.1
      enable_logging: false
    expectedBehavior: '1. High-frequency reporting (every 100ms)

      2. Tracks throughput metrics

      3. Identifies bottlenecks in pipeline

      '
    connectedTo:
    - queue
    - combiner
  - name: Discarding sink
    description: Sink that discards items without processing (benchmark baseline)
    params:
      operation: discard
      enable_logging: false
      max_items: 5000
    expectedBehavior: '1. Discards all received items

      2. Tracks total count until max_items

      3. Useful for pipeline performance testing

      '
    connectedTo:
    - fibonacci sequence
  relatedTypes:
  - queue
  - combiner
  - fibonacci sequence
  - prime sequence
  - numbers
  seeAlso:
  - queue-system recipe
  - qnet-pipeline recipe
  - Pipeline pattern documentation
  usageLimit:
    providers:
      min: 1
    users:
      min: 0
